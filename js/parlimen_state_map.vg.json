{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": "container",
  "height": 300,
  "autosize": {"type": "fit", "contains": "padding"},

  "params": [
    {
      "name": "selected_state",
      "value": "W.P. Kuala Lumpur",
      "bind": {
        "input": "select",
        "options": [
          "Perlis","Kedah","Pulau Pinang","Perak","Selangor",
          "Negeri Sembilan","Melaka","Johor","Pahang","Terengganu",
          "Kelantan","Sarawak","Sabah",
          "W.P. Labuan","W.P. Kuala Lumpur","W.P. Putrajaya"
        ],
        "labels": [
          "Perlis","Kedah","Penang","Perak","Selangor",
          "Negeri Sembilan","Malacca","Johor","Pahang","Terengganu",
          "Kelantan","Sarawak","Sabah",
          "Labuan","Kuala Lumpur","Putrajaya"
        ],
        "name": "State: "
      }
    }
  ],

  "projection": {"type": "mercator"},

  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Aiyaya78/FIT3179-DataVisualisation2/main/js/parlimen.topojson",
        "format": {"type": "topojson", "feature": "parlimen.topojson"}
      },
      "transform": [
        {"filter": "datum.properties.state === selected_state"},
        {
          "lookup": "properties.parlimen",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/Aiyaya78/FIT3179-DataVisualisation2/main/data/ge15_winningANDturnout_by_constituency.csv"
            },
            "key": "id_geo",
            "fields": [
              "state","code_parlimen","constituency",
              "winning_party","winning_majority","turnout_percent"
            ]
          }
        },
        {
          "lookup": "winning_party",
          "from": {
            "data": {
              "values": [
                {"coalition":"PH","full":"Pakatan Harapan (PH)"},
                {"coalition":"PN","full":"Perikatan Nasional (PN)"},
                {"coalition":"BN","full":"Barisan Nasional (BN)"},
                {"coalition":"GPS","full":"Gabungan Parti Sarawak (GPS)"},
                {"coalition":"GRS","full":"Gabungan Rakyat Sabah (GRS)"},
                {"coalition":"WARISAN","full":"Parti Warisan Sabah (WARISAN)"},
                {"coalition":"IND/OTH","full":"Independent / Others"}
              ]
            },
            "key": "coalition",
            "fields": ["full"]
          },
          "as": "winning_party_full"
        },
        {
          "lookup": "winning_party",
          "from": {
            "data": {
              "values": [
                {"coalition": "PH", "english": "Alliance of Hope (PH)"},
                {"coalition": "PN", "english": "National Alliance (PN)"},
                {"coalition": "BN", "english": "National Front (BN)"},
                {"coalition": "GPS", "english": "Sarawak Parties Alliance (GPS)"},
                {"coalition": "GRS", "english": "Sabah People's Coalition (GRS)"},
                {"coalition": "WARISAN", "english": "Heritage Party (WARISAN)"},
                {"coalition": "IND/OTH", "english": "Independent / Others"}
              ]
            },
            "key": "coalition",
            "fields": ["english"]
          }
          },
          {
            "lookup": "state",
            "from": {
              "data": {
                "values": [
                  {"state": "Johor", "state_en": "Johor"},
                  {"state": "Kedah", "state_en": "Kedah"},
                  {"state": "Kelantan", "state_en": "Kelantan"},
                  {"state": "Melaka", "state_en": "Malacca"},
                  {"state": "Negeri Sembilan", "state_en": "Negeri Sembilan"},
                  {"state": "Pahang", "state_en": "Pahang"},
                  {"state": "Perak", "state_en": "Perak"},
                  {"state": "Perlis", "state_en": "Perlis"},
                  {"state": "Pulau Pinang", "state_en": "Penang"},
                  {"state": "Sabah", "state_en": "Sabah"},
                  {"state": "Sarawak", "state_en": "Sarawak"},
                  {"state": "Selangor", "state_en": "Selangor"},
                  {"state": "Terengganu", "state_en": "Terengganu"},
                  {"state": "Wilayah Persekutuan Kuala Lumpur", "state_en": "Federal Territory of Kuala Lumpur"},
                  {"state": "Wilayah Persekutuan Labuan", "state_en": "Federal Territory of Labuan"},
                  {"state": "Wilayah Persekutuan Putrajaya", "state_en": "Federal Territory of Putrajaya"}
                ]
              },
              "key": "state",
              "fields": ["state_en"]
            }
          }
      ],
      "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 1},
      "encoding": {
        "color": {
          "field": "winning_party",
          "type": "nominal",
          "scale": {
            "domain": ["PH","PN","BN","GPS","GRS","WARISAN","IND/OTH"],
            "range": ["#bd0026","#1039ad","#15ace8","#ff4719","#fe9929","#fed976","#4ad7e8"]
          },
          "legend": {
            "orient": "bottom",
            "direction": "horizontal",
            "symbolType": "circle",
            "symbolSize": 250,
            "title": null,
            "labelFontSize": 10,
            "labelLimit": 0
          }
        },
        "tooltip": [
          {"field": "code_parlimen", "title": "Parliament Code"},
          {"field": "constituency", "title": "Constituency"},
          {"field": "state_en", "title": "State"},
          {"field": "english", "title": "Winner"},
          {"field": "winning_majority", "type": "quantitative", "title": "Winning Majority", "format": ","},
          {"field": "turnout_percent", "type": "quantitative", "title": "Voter Turnout (%)", "format": ".1f"}
        ]
      }
    },

    {
      "data": {
        "url": "https://raw.githubusercontent.com/Aiyaya78/FIT3179-DataVisualisation2/main/js/state.topojson",
        "format": {"type": "topojson", "feature": "state.topojson"}
      },
      "transform": [{"filter": "datum.properties.state === selected_state"}],
      "mark": {"type": "geoshape", "fill": null, "stroke": "#000", "strokeWidth": 3}
    }
  ]
}