{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": "container",
  "height": 300,
  "autosize": {"type": "fit-x", "resize": true},

  "data": {
    "url": "https://raw.githubusercontent.com/Aiyaya78/FIT3179-DataVisualisation2/refs/heads/main/data/state_turnout_2004to2022.csv"
  },

  "params": [
    {
      "name": "regionSel",
      "value": "All",
      "bind": {
        "input": "select",
        "options": ["All", "Peninsular", "East Malaysia", "Federal Territory"],
        "name": "Region: "
      }
    }
  ],

  "transform": [
    {
      "lookup": "state",
      "from": {
        "data": {
          "values": [
            {"state":"Perlis","region":"Peninsular"},
            {"state":"Kedah","region":"Peninsular"},
            {"state":"Penang","region":"Peninsular"},
            {"state":"Perak","region":"Peninsular"},
            {"state":"Selangor","region":"Peninsular"},
            {"state":"Negeri Sembilan","region":"Peninsular"},
            {"state":"Melaka","region":"Peninsular"},
            {"state":"Johor","region":"Peninsular"},
            {"state":"Pahang","region":"Peninsular"},
            {"state":"Terengganu","region":"Peninsular"},
            {"state":"Kelantan","region":"Peninsular"},
            {"state":"Sabah","region":"East Malaysia"},
            {"state":"Sarawak","region":"East Malaysia"},
            {"state":"Wilayah Persekutuan Kuala Lumpur","region":"Federal Territory"},
            {"state":"Wilayah Persekutuan Putrajaya","region":"Federal Territory"},
            {"state":"Wilayah Persekutuan Labuan","region":"Federal Territory"}
          ]
        },
        "key": "state",
        "fields": ["region"]
      }
    },
    {"filter": "regionSel === 'All' ? true : datum.region === regionSel"},
    {
      "lookup": "state",
      "from": {
        "data": {
          "values": [
            {"state": "Wilayah Persekutuan Kuala Lumpur", "short": "Kuala Lumpur"},
            {"state": "Wilayah Persekutuan Putrajaya",   "short": "Putrajaya"},
            {"state": "Wilayah Persekutuan Labuan",      "short": "Labuan"},
            {"state": "Johor", "short": "Johor"},
            {"state": "Kedah", "short": "Kedah"},
            {"state": "Kelantan", "short": "Kelantan"},
            {"state": "Melaka", "short": "Malacca"},
            {"state": "Negeri Sembilan", "short": "Negeri Sembilan"},
            {"state": "Pahang", "short": "Pahang"},
            {"state": "Perak", "short": "Perak"},
            {"state": "Perlis", "short": "Perlis"},
            {"state": "Pulau Pinang", "short": "Penang"},
            {"state": "Sabah", "short": "Sabah"},
            {"state": "Sarawak", "short": "Sarawak"},
            {"state": "Selangor", "short": "Selangor"},
            {"state": "Terengganu", "short": "Terengganu"}
          ]
        },
        "key": "state",
        "fields": ["short"]
      }
    },
    { "calculate": "isValid(datum.short) ? datum.short : datum.state", "as": "state_short" },
    {
            "lookup": "state",
            "from": {
              "data": {
                "values": [
                  {"state": "Johor", "state_en": "Johor"},
                  {"state": "Kedah", "state_en": "Kedah"},
                  {"state": "Kelantan", "state_en": "Kelantan"},
                  {"state": "Melaka", "state_en": "Malacca"},
                  {"state": "Negeri Sembilan", "state_en": "Negeri Sembilan"},
                  {"state": "Pahang", "state_en": "Pahang"},
                  {"state": "Perak", "state_en": "Perak"},
                  {"state": "Perlis", "state_en": "Perlis"},
                  {"state": "Pulau Pinang", "state_en": "Penang"},
                  {"state": "Sabah", "state_en": "Sabah"},
                  {"state": "Sarawak", "state_en": "Sarawak"},
                  {"state": "Selangor", "state_en": "Selangor"},
                  {"state": "Terengganu", "state_en": "Terengganu"},
                  {"state": "Wilayah Persekutuan Kuala Lumpur", "state_en": "Federal Territory of Kuala Lumpur"},
                  {"state": "Wilayah Persekutuan Labuan", "state_en": "Federal Territory of Labuan"},
                  {"state": "Wilayah Persekutuan Putrajaya", "state_en": "Federal Territory of Putrajaya"}
                ]
              },
              "key": "state",
              "fields": ["state_en"]
            }
          }

  ],

  "layer": [
    {
      "mark": {"type": "rect", "stroke": null},
      "encoding": {
        "x": {
          "field": "election", "type": "ordinal",
          "sort": ["GE11","GE12","GE13","GE14","GE15"],
          "title": "Election",
          "scale": {"paddingInner": 0, "paddingOuter": 0}
        },
        "y": {
          "field": "state_short", "type": "nominal",
          "title": "State",
          "sort": {"field":"turnout_percent", "op":"mean", "order":"descending"},
          "scale": {"paddingInner": 0, "paddingOuter": 0}
          
        },
        "color": {
          "field": "turnout_percent", "type": "quantitative",
          "title": "Turnout (%)",
          "scale": {
            "type": "threshold", 
            "domain":[50,60,70,80,90], 
            "range":["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"]}
        },
        "tooltip": [
          {"field": "state_en", "title": "State"},
          {"field": "election", "title": "Election"},
          {"field": "year", "title": "Year"},
          {"field": "turnout_percent", "type": "quantitative", "title": "Turnout Rate (%)", "format": ".2f"},
          {"field": "registered_voters", "type": "quantitative", "title": "Registered Voter", "format": ","},
          {"field": "voted", "type": "quantitative", "title": "Voted", "format": ","}
        ]
      }
    }
  ],

  "config": {
    "view": {"stroke": null},
    "axis": {"grid": false}
  }
}